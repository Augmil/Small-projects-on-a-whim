
# js 正则表达式

***
[toc]

***
## RegExp对象

### RegExp对象创建
RegExp 对象表示正则表达式，它是对字符串执行模式匹配的强大工具。
创建 RegExp 对象的语法：
```javascript
var reg = new RegExp(pattern, attributes);
```
参数 pattern 是一个字符串，指定了正则表达式的模式或其他正则表达式。

参数 attributes 是一个可选的字符串，包含属性 "g"、"i" 和 "m"，分别用于指定全局匹配、区分大小写的匹配和多行匹配。ECMAScript 标准化之前，不支持 m 属性。如果 pattern 是正则表达式，而不是字符串，则必须省略该参数。

也可以直接创建语法如下

```javascript
// var reg = /正则规则/匹配模式;
var reg = /\d/g; // --> 匹配所有数字
```

## 正则规则速查
### RegExp对象属性

| 属性        | 描述                                               |
| :---------- | :------------------------------------------------- |
| constructor | 返回一个函数，该函数是一个创建 RegExp 对象的原型。 |
| global      | 判断是否设置了 "g" 修饰符                          |
| ignoreCase  | 判断是否设置了 "i" 修饰符                          |
| lastIndex   | 用于规定下次匹配的起始位置                         |
| multiline   | 判断是否设置了 "m" 修饰符                          |
| source      | 返回正则表达式的匹配模式                           |


### RegExp 对象方法

| 方法     |                        描述                        |
| :------- | :------------------------------------------------: |
| exec     | 检索字符串中指定的值。返回找到的值，并确定其位置。 |
| test     |     检索字符串中指定的值。返回 true 或 false。     |
| toString |              返回正则表达式的字符串。              |

### 支持正则的 String 方法

| 方法    | 描述                             |
| :------ | :------------------------------- |
| search  | 检索与正则表达式相匹配的值。     |
| match   | 找到一个或多个正则表达式的匹配。 |
| replace | 替换与正则表达式匹配的子串。     |
| split   | 把字符串分割为字符串数组。       |


### 模式修饰符

| 修饰符 | 描述           |
| :----- | :------------- |
| i      | 不区分大小写。 |
| g      | 执行全局匹配。 |
| m      | 执行多行匹配。 |
| y      |                |
| u      |                |


### 元字符

元字符（Metacharacter）是拥有特殊含义的字符：

| 元字符 | 描述                                        |
| :----- | :------------------------------------------ |
| .      | 查找单个字符，除了换行和行结束符。          |
| \w     | 查找**字母**字符。                          |
| \W     | 查找**非字母**字符。                        |
| \d     | 查找**数字**。                              |
| \D     | 查找**非数字**字符。                        |
| \s     | 查找**空白**字符。                          |
| \S     | 查找**非空白**字符。                        |
| \b     | 匹配**单词边界**。                          |
| \B     | 匹配**非单词边界**。                        |
| \0     | 查找 **NUL** 字符。                         |
| \n     | 查找**换行符**。                            |
| \f     | 查找**换页符**。                            |
| \r     | 查找**回车符**。                            |
| \t     | 查找**制表符**。                            |
| \v     | 查找**垂直制表符**。                        |
| \xxx   | 查找以八进制数 xxx 规定的字符。             |
| \xdd   | 查找以十六进制数 dd 规定的字符。            |
| \uxxxx | 查找以十六进制数 xxxx 规定的 Unicode 字符。 |
| \p{n}  | 根据{}z中的属性进行匹配                     |


### 量词

| 量词   | 描述                                      | 区间表示 |
| :----- | :---------------------------------------- | :------- |
| n+     | 匹配任何包含**至少一个** n 的字符串。     | [1,+∞]   |
| n*     | 匹配任何包含**零个或多个** n 的字符串。   | [0,+∞]   |
| n?     | 匹配任何包含**零个或一个** n 的字符串。   | [0,1]    |
| n{X}   | 匹配包含 **X 个** n 的序列的字符串。      | X        |
| n{X,Y} | 匹配包含 **X 至 Y 个** n 的序列的字符串。 | [X,Y]    |
| n{X,}  | 匹配包含**至少 X 个** n 的序列的字符串。  | [X,+∞]   |


### 禁止贪婪

量词接问号 表示只需数量满足量词的最低要求，禁止往后匹配更多字符。
| 量词    | 区间表示 |
| :------ | :------- |
| n+?     | 1        |
| n*?     | 0        |
| n{X,Y}? | X        |
| n{X,}?  | X        |


### 原子表（方括号）

| 原子表 | 描述                                    |
| :----- | :-------------------------------------- |
| [n]    | 匹配任何**方括号包含**的n字符。         |
| [^n]   | 匹配任何**方括号不包含包含**的非n字符。 |


 ### 原子组（方括号） 
 
| 原子组          | 描述                     |
| :-------------- | :----------------------- |
| (n)             | 将括号内的规则n编为一组  |
| (?<groupName>n) | 给原子组命名             |
| (?:n)           | 不记录原子表，不给它编号 |

**用法**
```javascript
// 原子组序号 从左往右 以左括号序号为准，序号0为正则整体
/**
 * reg -> /(n)((n)(n))/
 * 序号-> /1n123n34n42/
 * */

// 在正则中用 \+序号（如 \1） 调用
let str1 = 'oo1too 1too 1tooo 1to tttt';
let reg1 = /(1to+).+\1/;
let res1 = str1.match(reg1) // '1to 1too 1too'

// 在替换结果字符串中 用 $+序号（如 $1） 调用
let str2 = '111222333';
let reg2 = /(111)(222)/;
let res2 = str2.replace(reg2,'$0="$0";$1="$1";$2="$2"') // '$0="111222333";$1="111";$2="222"'
```

### 选择符
| 原子组       | 描述                                                 |
| :----------- | :--------------------------------------------------- |
| n1\|n2\|n3   | 满足n1、n2、n3、中任何一个规则的字符串               |
| (n1\|n2\|n3) | 满足n1、n2、n3、中任何一个规则的字符串，将其和为一组 |



### 边界约束
| 边界符 | 描述                              |
| :----- | :-------------------------------- |
| ^n     | 约束**开始**的n字符串必须满足规则 |
| n$     | 约束**末尾**的n字符串必须满足规则 |

### 断言匹配

| 字符 | 描述                                            |
| :--- | :---------------------------------------------- |
| ?=n  | 匹配任何**后面**紧接指定字符串 n 的字符串。     |
| ?<=n | 匹配任何**前面**紧接指定字符串 n 的字符串。     |
| ?!n  | 匹配任何**后面没有**紧接指定字符串 n 的字符串。 |
| ?<!n | 匹配任何**前面没有**紧接指定字符串 n 的字符串。 |

***
## 用法详解

### 元字符

元字符（Metacharacter）是拥有特殊含义的字符。对于\w、\d、\s、\b等元字符大小写通常表示相反含义，例如\w 等同于 `[^\W]`。因此可以通过大小字母组合匹配所有字符，例如[/s/S]能够匹配任何字符。当然[^]同样可以匹配任意字符。

### 量词和禁止贪婪

量词表示匹配单个字符的数量，例如 + 表示至少一个。量词默认进行贪婪匹配，即只要满足要求就一直往后匹配。在量词后加上问号（?）可以阻止贪婪匹配，将匹配的字符数量最小化，只要匹配到的字符数满足最低要求，就不再匹配更多数量的字符。这可以阻止重复内容只匹配一个，例如：
```javascript
// 匹配以下字符串中的等式
let str = `
2+5 = 7
2+6 = 8
2-2 = 0
`
let reg1 = /[\s\S]+=[\s\S](\d)/g
console.log(str.match(reg1))
/* 仅仅匹配到一个
`2+5 = 7\n2+6 = 8\n2-2 = 0`
*/
// 禁止贪婪
let reg1 = /[\s\S]+?=[\s\S]+?(\d)/g

console.log(str.match(reg1))
/* 可以匹配到三个
\n2+5 = 7\n
\n2+6 = 8\n
\n2-2 = 0\n
*/

```


### 转义字符问题

需要表示字符 **\` \~ \! \@ \# \$ \% \^ \& \* \( \) \- \_ \= \+ \[ \] \{ \} \\ \/ \| \: \; \' \" \. \, \< \> \?** 的原本含义时，无论是否需要转义，**都可以直接转义**不会出错，但在不必要的地方转义会增加正则表达式的复杂度，不利于阅读。

| 位置  | 名称  | 使用  | 用途 | 全局  |  ()   |  []   |  {}   |
| :---: | :---: | :---: | :--- | :---: | :---: | :---: | :---: |
|   `   |       |       |      |       |       |       |       |
|   ~   |       |       |      |       |       |       |       |
|   !   |       |   √   |      |       |       |       |       |
|   @   |       |       |      |       |       |       |       |
|   #   |       |       |      |       |       |       |       |
|   $   |       |   √   |      |   √   |   √   |       |   √   |
|   %   |       |       |      |       |       |       |       |
|   ^   |       |   √   |      |   √   |   √   |       |   √   |
|   &   |       |       |      |       |       |       |       |
|   *   |       |   √   |      |   √   |   √   |       |   √   |
|   (   |       |   √   |      |   √   |   √   |       |   √   |
|   )   |       |   √   |      |   √   |   √   |       |   √   |
|   -   |       |   √   |      |       |       |   -   |       |
|   _   |       |       |      |       |       |       |       |
|   =   |       |   √   |      |       |       |       |       |
|   +   |       |   √   |      |   √   |   √   |       |   √   |
|   [   |       |   √   |      |   √   |   √   |       |   √   |
|   ]   |       |   √   |      |       |       |   √   |   √   |
|   {   |       |   √   |      |       |       |       |       |
|   }   |       |   √   |      |       |       |       |       |
|   \   |       |   √   |      |   √   |   √   |   √   |   √   |
|   /   |       |   √   |      |       |       |       |       |
|  \|   |       |   √   |      |   √   |   √   |       |   √   |
|   :   |       |   √   |      |       |       |       |       |
|   ;   |       |       |      |       |       |       |       |
|   '   |       |       |      |       |       |       |       |
|   "   |       |       |      |       |       |       |       |
|   .   |       |   √   |      |   √   |   √   |       |   √   |
|   ,   |       |   √   |      |       |       |       |       |
|   <   |       |   √   |      |       |       |       |       |
|   >   |       |       |      |       |       |       |       |
|   ?   |       |   √   |      |   √   |   √   |       |   √   |
*注：√ 需要注释* - 情况特殊需分类处理

全局、()、{}中 **\$ \^ \* \( \) \+ \[ \\ \| \. \?** 。都需要转义；
原子表[]中 **\、 ]** 需要转义，**-** 需要视情况而定，前后均有字符时需要转义，即[2-5]需要转义，[-n]、[n-]不需要转义。


### test()方法
**定义和用法**
test() 方法用于检测一个字符串是否匹配某个模式.

**语法**
`RegExpObject.test(string)`

**参数**
string	必需。要检测的字符串。

**返回值**
如果字符串 string 中含有与 RegExpObject 匹配的文本，则返回 true，否则返回 false。

**说明**
`reg.test(string)` 等价于 `(reg..exec(string) != null)`

**实例**

```javascript
let reg = /\d/;
let str1 = '3d';
let str2 = 'dd';
console.log(reg.test(str1)) // true
console.log(reg.test(str2)) // false
```

### exec()方法

**定义和用法**
exec() 方法用于检索字符串中的正则表达式的匹配。

**语法**
`RegExpObject.exec(string)`

**参数**
string	必需。要检索的字符串。

**返回值**
返回一个数组，其中存放匹配的结果。如果未找到匹配，则返回值为 null。

**说明**
exec() 方法的功能非常强大，它是一个通用的方法，而且使用起来也比 test() 方法以及支持正则表达式的 String 对象的方法更为复杂。

如果 exec() 找到了匹配的文本，则返回一个结果数组。否则，返回 null。此数组的第 0 个元素是与正则表达式相匹配的文本，第 1 个元素是与 RegExpObject 的第 1 个子表达式相匹配的文本（如果有的话），第 2 个元素是与 RegExpObject 的第 2 个子表达式相匹配的文本（如果有的话），以此类推。除了数组元素和 length 属性之外，exec() 方法还返回两个属性。index 属性声明的是匹配文本的第一个字符的位置。input 属性则存放的是被检索的字符串 string。我们可以看得出，在调用非全局的 RegExp 对象的 exec() 方法时，返回的数组与调用方法 String.match() 返回的数组是相同的。

但是，当 RegExpObject 是一个全局正则表达式时，exec() 的行为就稍微复杂一些。它会在 RegExpObject 的 lastIndex 属性指定的字符处开始检索字符串 string。当 exec() 找到了与表达式相匹配的文本时，在匹配后，它将把 RegExpObject 的 lastIndex 属性设置为匹配文本的最后一个字符的下一个位置。这就是说，您可以通过反复调用 exec() 方法来遍历字符串中的所有匹配文本。当 exec() 再也找不到匹配的文本时，它将返回 null，并把 lastIndex 属性重置为 0。

**实例**
```javascript
let reg = /成功/g;
let str = '成功失败成功失败成功失败成功失败';
while (res = reg.exec(str))  {
    console.log(res,reg.lastIndex,);
}
```

### String对象 search()方法
**定义和用法**
search() 方法用于检索字符串中指定的子字符串，或检索与正则表达式相匹配的子字符串。

**语法**
`stringObject.search(regexp)`
**返回值**
stringObject 中第一个与 regexp 相匹配的子串的起始位置。
注释：如果没有找到任何匹配的子串，则返回 -1。

**说明**
search() 方法不执行全局匹配，它将忽略标志 g。它同时忽略 regexp 的 lastIndex 属性，并且总是从字符串的开始进行检索，这意味着它总是返回 stringObject 的第一个匹配的位置。

**实例**
```javascript
var str="匹配成功"
document.write(str.search(/成功/))；
```


### String对象 match()方法
**定义和用法**
match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。

该方法类似 indexOf() 和 lastIndexOf()，但是它返回指定的值，而不是字符串的位置。

**语法**
`stringObject.match(searchvalue)`
`stringObject.match(regexp)`

**返回值**
存放匹配结果的数组。该数组的内容依赖于 regexp 是否具有全局标志 g。

**实例**
```javascript
var str="1 plus 2 equal 3"
document.write(str.match(/\d+/g))
```


### String对象 replace()方法
**定义和用法**
replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。

**语法**
`stringObject.replace(regexp/substr,replacement)`

**参数**
regexp/substr 必需。规定子字符串或要替换的模式的 RegExp 对象。请注意，如果该值是一个字符串，则将它作为要检索的直接量文本模式，而不是首先被转换为 RegExp 对象。
replacement 必需。一个字符串值。规定了替换文本或生成替换文本的函数。

**返回值**
一个新的字符串，是用 replacement 替换了 regexp 的第一次匹配或所有匹配之后得到的。

**说明**
字符串 stringObject 的 replace() 方法执行的是查找并替换的操作。它将在 stringObject 中查找与 regexp 相匹配的子字符串，然后用 replacement 来替换这些子串。如果 regexp 具有全局标志 g，那么 replace() 方法将替换所有匹配的子串。否则，它只替换第一个匹配子串。

replacement 可以是字符串，也可以是函数。如果它是字符串，那么每个匹配都将由字符串替换。但是 replacement 中的 $ 字符具有特定的含义。

| 字符               | 替换文本                                            |
| :----------------- | :-------------------------------------------------- |
| \$1、\$2、...、$99 | 与 regexp 中的第 1 到第 99 个子表达式相匹配的文本。 |
| $&                 | 与 regexp 相匹配的子串。                            |
| $`                 | 位于匹配子串左侧的文本。                            |
| $'                 | 位于匹配子串右侧的文本。                            |
| $$                 | 直接量符号。                                        |

**实例1**
```javascript
 // replacement为字符串
name = "Doe, John";
name.replace(/(\w+)\s*, \s*(\w+)/, "$2 $1"); //'John Doe'
```

**实例2**
```javascript
 // replacement为字符串
str = "Before and after";
str.replace(/and/, "<--前面：$` ；匹配到的：$&；后面：$'；直接量符号：$$；-->");
// 'Before <--前面：Before  ；匹配到的：and；后面： after；直接量符号：$；--> after'
```

**实例3**
```javascript
 // replacement为字符串
name = "Doe, John";
name.replace(/(\w+)\s*, \s*(\w+)/,(p0,p1,p2)=>{
console.log(`整体：${p0},字串1：${p1},字串2：${p2}`);
} );
// 整体：Doe, John,字串1：Doe,字串2：John
```


### String对象 split()方法

**定义和用法**
split() 方法用于把一个字符串分割成字符串数组。

**语法**
stringObject.split(separator,howmany)

**参数**
separator	必需。字符串或正则表达式，从该参数指定的地方分割 stringObject。
howmany	可选。该参数可指定返回的数组的最大长度。如果设置了该参数，返回的子串不会多于这个参数指定的数组。如果没有设置该参数，整个字符串都会被分割，不考虑它的长度。

**返回值**
一个字符串数组。该数组是通过在 separator 指定的边界处将字符串 stringObject 分割成子串创建的。返回的数组中的字串不包括 separator 自身。
但是，如果 separator 是包含子表达式的正则表达式，那么返回的数组中包括与这些子表达式匹配的字串（但不包括与整个正则表达式匹配的文本）。

**实例3**
```javascript
"2:3:4:5".split(/:/) //将返回["2", "3", "4", "5"]
"|a|b|c".split("|")	//将返回["", "a", "b", "c"]
```

***

## 参考
- [x] [w3school](https://www.w3school.com.cn/js/js_regexp.asp)
- [x] [B站 后盾人 正则表达式](https://www.bilibili.com/video/BV12J41147fC?p=1)
- [x] [CSDN JavaScript正则表达式需要转义的字符](https://blog.csdn.net/weixin_44100002/article/details/114373990)


***
- [x] 初稿日期：2022年04月04日



